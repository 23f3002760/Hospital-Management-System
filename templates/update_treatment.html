{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-10 col-lg-9">
            
            <div class="mb-3">
                <a href="{{ url_for('doctor_dashboard') if current_user.role == 'doctor' else url_for('admin_dashboard') }}" class="text-decoration-none text-muted fw-bold small">
                    &larr; Back to Dashboard
                </a>
            </div>

            <div class="card shadow-lg border-0 rounded-4 overflow-hidden">
                
                <div class="card-header p-4 border-bottom-0" style="background: linear-gradient(135deg, var(--brand-blue) 0%, var(--brand-green) 100%);">
                    <h2 class="fw-bold text-white mb-1">Update Patient History</h2>
                    <div class="d-flex flex-wrap gap-4 text-white small mt-2" style="opacity: 0.9;">
                        <span class="d-flex align-items-center"><i class="bi bi-person-fill me-2"></i> <strong>Patient:</strong>&nbsp; {{ appointment.patient_ref.username }}</span>
                        <span class="d-flex align-items-center"><i class="bi bi-hospital-fill me-2"></i> <strong>Dept:</strong>&nbsp; {{ appointment.doctor_ref.department.name if appointment.doctor_ref.department else 'General' }}</span>
                        <span class="d-flex align-items-center"><i class="bi bi-calendar-event-fill me-2"></i> <strong>Date:</strong>&nbsp; {{ appointment.appointment_date }}</span>
                    </div>
                </div>

                <div class="card-body p-5 pt-0">
                    <form method="POST">
                        
                        <div class="p-4 rounded-4 mt-4" style="background-color: #f8f9fa;">
                            
                            <div class="row g-4 mb-4">
                                <div class="col-md-4">
                                    <label class="form-label fw-bold text-secondary small text-uppercase">Visit Type</label>
                                    <div class="input-group shadow-sm rounded-3 overflow-hidden bg-white">
                                        <span class="input-group-text bg-white border-0 ps-3"><i class="bi bi-activity text-primary"></i></span>
                                        <select class="form-select border-0 py-2" name="visit_type">
                                            <option value="In-person">In-person</option>
                                            <option value="Online">Online Consultation</option>
                                            <option value="Follow-up">Follow-up</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <label class="form-label fw-bold text-secondary small text-uppercase">Tests Done</label>
                                    <div class="input-group shadow-sm rounded-3 overflow-hidden bg-white">
                                        <span class="input-group-text bg-white border-0 ps-3"><i class="bi bi-clipboard-pulse text-success"></i></span>
                                        <input type="text" class="form-control border-0 py-2" name="tests_done" placeholder="e.g. ECG, Blood Test" value="{{ treatment.doctor_notes if treatment else '' }}">
                                    </div>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="form-label fw-bold text-secondary small text-uppercase">Diagnosis</label>
                                <div class="shadow-sm rounded-3 bg-white p-2">
                                    <textarea name="diagnosis" class="form-control border-0" rows="2" placeholder="Clinical diagnosis..." required style="resize: none;">{{ treatment.diagnosis if treatment else '' }}</textarea>
                                </div>
                            </div>

                            <div class="row g-4">
                                <div class="col-md-7">
                                    <label class="form-label fw-bold text-secondary small text-uppercase">Prescription / Notes</label>
                                    <div class="shadow-sm rounded-3 bg-white p-2 h-100">
                                        <textarea name="prescription" class="form-control border-0 h-100" rows="6" placeholder="Detailed prescription notes..." required style="resize: none;">{{ treatment.prescription if treatment else '' }}</textarea>
                                    </div>
                                </div>
                                
                                <div class="col-md-5">
                                    <label class="form-label fw-bold text-secondary small text-uppercase">Medicines (Dosage)</label>
                                    <div class="shadow-sm rounded-3 bg-white h-100 overflow-hidden d-flex flex-column">
                                        <div class="bg-light p-2 border-bottom d-flex justify-content-between align-items-center">
                                            <small class="text-muted fw-bold">Format: Name (1-0-1)</small>
                                            <i class="bi bi-capsule text-warning"></i>
                                        </div>
                                        <textarea class="form-control border-0 p-3 h-100" style="resize: none; font-family: 'Courier New', monospace; font-size: 0.9rem; line-height: 1.6;" rows="5" placeholder="Medicine A   1-0-1&#10;Medicine B   0-1-1&#10;Medicine C   1-0-0"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4 pt-2 d-flex justify-content-between align-items-center">
                            <button type="submit" class="btn btn-success btn-lg px-5 rounded-pill shadow-lg fw-bold border-0" style="background: linear-gradient(135deg, var(--brand-green), #008f5a);">
                                Save 
                            </button>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}